<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ripple Studio AI</title>
  <style>
    :root {
      --bg: #0f0f0f;
      --text: #ffffff;
      --user-bg: #4b6cb7;
      --bot-bg: #2e2e2e;
    }
    body.light {
      --bg: #ffffff;
      --text: #000000;
      --user-bg: #cce5ff;
      --bot-bg: #f1f1f1;
    }
    body.blue {
      --bg: #001f3f;
      --text: #ffffff;
      --user-bg: #0074d9;
      --bot-bg: #003366;
    }
    body.pink {
      --bg: #ffe6f0;
      --text: #4b004b;
      --user-bg: #ff99cc;
      --bot-bg: #ffe0f0;
    }
    body.cyber {
      --bg: #0f0f0f;
      --text: #00ffea;
      --user-bg: #00ffaa;
      --bot-bg: #003b3b;
    }
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      height: 100vh;
      transition: background 0.3s, color 0.3s;
    }
    .hidden { display: none; }
    #loginPage {
      display: flex;
      justify-content: center;
      align-items: center;
      flex: 1;
      position: relative;
    }
    #googleSignIn {
      padding: 10px 20px;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 10px;
    }
    #userDropdown {
      position: absolute;
      top: 10px;
      right: 10px;
      display: none;
    }
    #userButton {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text);
    }
    #dropdownMenu {
      display: none;
      position: absolute;
      right: 0;
      margin-top: 5px;
      background: var(--bot-bg);
      color: var(--text);
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    #dropdownMenu button {
      display: block;
      padding: 8px 12px;
      border: none;
      background: transparent;
      color: var(--text);
      width: 100%;
      text-align: left;
      cursor: pointer;
    }
    #dropdownMenu button:hover {
      background: rgba(255,255,255,0.1);
    }
    #chatUI {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    #themeToggle {
      position: absolute;
      top: 10px;
      left: 10px;
      background: none;
      color: var(--text);
      border: 1px solid var(--text);
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 1rem;
      z-index: 100;
    }
    #chat {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .message {
      padding: 14px 20px;
      border-radius: 20px;
      max-width: 80%;
      font-size: 1rem;
      line-height: 1.4;
      animation: fadeIn 0.3s;
    }
    .user { background: var(--user-bg); align-self: flex-end; }
    .bot { background: var(--bot-bg); align-self: flex-start; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-top: 1px solid var(--text);
    }
    .controls button, .controls select {
      padding: 8px 12px;
      font-size: 1rem;
      border-radius: 6px;
      border: none;
      background: var(--bot-bg);
      color: var(--text);
      cursor: pointer;
    }
    #inputArea {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
    }
    #input {
      width: 90%;
      max-width: 500px;
      padding: 12px 20px;
      font-size: 1rem;
      border-radius: 25px;
      border: none;
      background: var(--bot-bg);
      color: var(--text);
      outline: none;
      margin-top: 10px;
    }
    ::placeholder { color: #888; }
    .mic-button {
      background: radial-gradient(circle at center, #007aff, #003366);
      border: none;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      font-size: 2rem;
      color: white;
      box-shadow: 0 0 25px rgba(0,122,255,0.6);
      cursor: pointer;
      margin-bottom: 10px;
    }
    .mic-button:hover { transform: scale(1.05); }
    .mic-button:active { transform: scale(0.95); }
  </style>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js';
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBy8bjMRk69llFZ7bf2QosGOUIa4zEFGS8",
      authDomain: "ai-assitant-c62f6.firebaseapp.com",
      projectId: "ai-assitant-c62f6",
      storageBucket: "ai-assitant-c62f6.appspot.com",
      messagingSenderId: "1050697728777",
      appId: "1:1050697728777:web:f5a2eeaecb1256936789d8",
      measurementId: "G-5N25L6WM7T"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const provider = new GoogleAuthProvider();

    const signInBtn = document.getElementById('googleSignIn');
    const dropdown = document.getElementById('userDropdown');
    const dropdownMenu = document.getElementById('dropdownMenu');
    const userButton = document.getElementById('userButton');

    signInBtn.addEventListener('click', () => {
      signInWithPopup(auth, provider)
        .then(() => {})
        .catch((error) => alert('Login failed: ' + error.message));
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('chatUI').classList.remove('hidden');
        signInBtn.style.display = 'none';
        dropdown.style.display = 'block';
      } else {
        signInBtn.style.display = 'block';
        dropdown.style.display = 'none';
      }
    });

    userButton.addEventListener('click', () => {
      dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      signOut(auth).then(() => {
        location.reload();
      });
    });

    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.body.className = savedTheme;
    themeToggle.value = savedTheme;
    themeToggle.addEventListener('change', () => {
      document.body.className = themeToggle.value;
      localStorage.setItem('theme', themeToggle.value);
    });

    // Gemini chat
    const input = document.getElementById('input');
    const chat = document.getElementById('chat');
    const voiceSelect = document.getElementById('voiceSelect');
    const apiKey = 'AIzaSyBTPmXDzU3SjB8wSC7AAxo7xUZx8zFFTi8';

    function appendMessage(text, sender) {
      const msg = document.createElement('div');
      msg.className = 'message ' + sender;
      msg.textContent = text;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      const voices = speechSynthesis.getVoices();
      utter.voice = voices.find(v => v.lang.includes('en')) || voices[0];
      utter.lang = 'en-US';
      speechSynthesis.speak(utter);
    }

    function sendMessage() {
      const msg = input.value.trim();
      if (!msg) return;
      appendMessage(msg, 'user');
      input.value = '';

      fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ role: 'user', parts: [{ text: msg }] }],
          generation_config: { maxOutputTokens: 300, temperature: 0.7 }
        })
      })
      .then(res => res.json())
      .then(data => {
        const reply = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || 'Sorry, I did not understand that.';
        appendMessage(reply, 'bot');
        speak(reply);
      })
      .catch(() => appendMessage('Failed to get response.', 'bot'));
    }

    document.querySelector('.mic-button').onclick = () => {
      if (!('webkitSpeechRecognition' in window)) return alert('Speech not supported.');
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'en-US';
      recognition.start();
      recognition.onresult = e => {
        input.value = e.results[0][0].transcript;
        sendMessage();
      };
    };

    document.querySelector('button[title="Weather"]').onclick = () => {
      input.value = 'What is the weather today?';
      sendMessage();
    };

    document.querySelector('button[title="Joke"]').onclick = () => {
      input.value = 'Tell me a joke';
      sendMessage();
    };

    document.querySelector('button[title="Website"]').onclick = () => {
      const url = prompt('Enter website URL:', 'https://ripplestudio.in');
      if (url) window.open(url, '_blank');
    };

    document.querySelector('button[title="Stop"]').onclick = () => speechSynthesis.cancel();

    document.querySelector('button[title="Clear"]').onclick = () => chat.innerHTML = '';

    document.querySelector('button[title="Export"]').onclick = () => {
      const text = [...chat.querySelectorAll('.message')].map(m => m.classList.contains('user') ? 'USER: ' + m.textContent : 'BOT: ' + m.textContent).join('\n\n');
      const blob = new Blob([text], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'Ripple_Chat_History.txt';
      a.click();
    };

    input.addEventListener('keydown', e => {
      if (e.key === 'Enter') sendMessage();
    });
  </script>
</head>
<body>
  <div id="loginPage">
    <h1>Ripple Studio AI</h1>
    <button id="googleSignIn">Sign in with Google</button>
    <div id="userDropdown">
      <button id="userButton">üë§</button>
      <div id="dropdownMenu">
        <button id="logoutBtn">Logout</button>
      </div>
    </div>
  </div>
  <div id="chatUI" class="hidden">
    <select id="themeToggle">
      <option value="dark">üåô Dark</option>
      <option value="light">‚òÄÔ∏è Light</option>
      <option value="blue">üåä Blue</option>
      <option value="pink">üå∏ Pink</option>
      <option value="cyber">‚ö° Cyber</option>
    </select>
    <div id="chat"></div>
    <div class="controls">
      <button title="Weather">‚õÖ</button>
      <button title="Joke">üòÇ</button>
      <button title="Website">üåê</button>
      <button title="Stop">üõë</button>
      <button title="Clear">üßπ Clear</button>
      <button title="Export">‚¨áÔ∏è Export</button>
      <select id="voiceSelect"></select>
    </div>
    <div id="inputArea">
      <button class="mic-button">üé§</button>
      <input id="input" type="text" placeholder="Tap mic or type...">
    </div>
  </div>
</body>
</html>
